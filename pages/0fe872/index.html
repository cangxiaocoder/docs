<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis数据结构 | 苍晓 blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/docs/img/favicon.ico">
    <meta name="description" content="Java后端开发技术博客,专注Java后端学习与总结。Java、MySQL、Redis、MQ、Linux等技术文章。">
    <meta name="keywords" content="后端博客,个人技术博客,后端,后端开发,后端框架,Java后端,Java面试题,技术文档,学习,面试,Java、MySQL、Redis、MQ、Linux、markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/docs/assets/css/0.styles.bbbe363d.css" as="style"><link rel="preload" href="/docs/assets/js/app.64f7fb70.js" as="script"><link rel="preload" href="/docs/assets/js/2.9aaacc6a.js" as="script"><link rel="preload" href="/docs/assets/js/3.039d8d6e.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.f6b2464f.js"><link rel="prefetch" href="/docs/assets/js/11.49c4c944.js"><link rel="prefetch" href="/docs/assets/js/12.5450ceb1.js"><link rel="prefetch" href="/docs/assets/js/13.96a2f0be.js"><link rel="prefetch" href="/docs/assets/js/14.f275c5e7.js"><link rel="prefetch" href="/docs/assets/js/15.58e51d33.js"><link rel="prefetch" href="/docs/assets/js/16.59a0dbad.js"><link rel="prefetch" href="/docs/assets/js/17.16ada192.js"><link rel="prefetch" href="/docs/assets/js/18.61765691.js"><link rel="prefetch" href="/docs/assets/js/19.807a4712.js"><link rel="prefetch" href="/docs/assets/js/20.fa607b17.js"><link rel="prefetch" href="/docs/assets/js/21.bb80a3c8.js"><link rel="prefetch" href="/docs/assets/js/22.c80871ea.js"><link rel="prefetch" href="/docs/assets/js/23.a4d8c9c6.js"><link rel="prefetch" href="/docs/assets/js/24.c3466870.js"><link rel="prefetch" href="/docs/assets/js/25.ee7bd2c7.js"><link rel="prefetch" href="/docs/assets/js/26.1cda28ca.js"><link rel="prefetch" href="/docs/assets/js/27.7d0bb693.js"><link rel="prefetch" href="/docs/assets/js/28.702f2c8e.js"><link rel="prefetch" href="/docs/assets/js/29.3fce4c28.js"><link rel="prefetch" href="/docs/assets/js/4.1b8a1370.js"><link rel="prefetch" href="/docs/assets/js/5.083f1bd8.js"><link rel="prefetch" href="/docs/assets/js/6.bc3dce58.js"><link rel="prefetch" href="/docs/assets/js/7.0738b24b.js"><link rel="prefetch" href="/docs/assets/js/8.50b9ab7e.js"><link rel="prefetch" href="/docs/assets/js/9.35e09d56.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.bbbe363d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><img src="/docs/img/logo.jpg" alt="苍晓 blog" class="logo"> <span class="site-name can-hide">苍晓 blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">首页</a></div><div class="nav-item"><a href="/docs/Linux/Linux基础操作.html" class="nav-link">Linux</a></div><div class="nav-item"><a href="/docs/MySQL/MySQL.html" class="nav-link">MySQL</a></div><div class="nav-item"><a href="/docs/Redis/Redis基础.html" class="nav-link">Redis</a></div><div class="nav-item"><a href="/docs/kafka/kafka基础.html" class="nav-link">kafka</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="苍晓 Java 博客" class="dropdown-title"><!----> <span class="title" style="display:;">苍晓 Java 博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/cangxiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cangxiaocoder" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/cangxiaocoder/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="img/avator.jpg"> <div class="blogger-info"><h3>苍晓</h3> <span>Java后端开发</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">首页</a></div><div class="nav-item"><a href="/docs/Linux/Linux基础操作.html" class="nav-link">Linux</a></div><div class="nav-item"><a href="/docs/MySQL/MySQL.html" class="nav-link">MySQL</a></div><div class="nav-item"><a href="/docs/Redis/Redis基础.html" class="nav-link">Redis</a></div><div class="nav-item"><a href="/docs/kafka/kafka基础.html" class="nav-link">kafka</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="苍晓 Java 博客" class="dropdown-title"><!----> <span class="title" style="display:;">苍晓 Java 博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://gitee.com/cangxiao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/cangxiaocoder" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <a href="https://github.com/cangxiaocoder/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/docs/Redis/Redis" class="sidebar-heading clickable open"><span>Redis</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/pages/8bd4f4/" class="sidebar-link">Redis基本操作</a></li><li><a href="/docs/pages/0fe872/" aria-current="page" class="active sidebar-link">Redis数据结构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/docs/pages/0fe872/#sds" class="sidebar-link">SDS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#sds与c字符串的区别" class="sidebar-link">SDS与C字符串的区别</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#sds字符串结构" class="sidebar-link">SDS字符串结构：</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#o-1-复杂度获取字符串长度" class="sidebar-link">O(1)复杂度获取字符串长度</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#避免缓冲区溢出" class="sidebar-link">避免缓冲区溢出</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#减少内存重分配" class="sidebar-link">减少内存重分配</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#二进制安全" class="sidebar-link">二进制安全</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/docs/pages/0fe872/#链表" class="sidebar-link">链表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#链表结构" class="sidebar-link">链表结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#链表节点" class="sidebar-link">链表节点</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#链表-2" class="sidebar-link">链表</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#链表的特点" class="sidebar-link">链表的特点</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/docs/pages/0fe872/#ziplist" class="sidebar-link">ziplist</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#压缩列表结构" class="sidebar-link">压缩列表结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#节点结构" class="sidebar-link">节点结构</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#previous-entry-length" class="sidebar-link">previousentrylength</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#encoding" class="sidebar-link">encoding</a></li><li class="sidebar-sub-header level5"><a href="/docs/pages/0fe872/#content" class="sidebar-link">content</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#连锁更新" class="sidebar-link">连锁更新</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/docs/pages/0fe872/#listpack" class="sidebar-link">listpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#listpack结构" class="sidebar-link">listpack结构</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/docs/pages/0fe872/#quicklist" class="sidebar-link">quickList</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#旧quicklist结构" class="sidebar-link">旧quickList结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#旧quicklistnode结构" class="sidebar-link">旧quickListNode结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#redis7quicklist结构" class="sidebar-link">Redis7quickList结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#redis7quicklistnode结构" class="sidebar-link">Redis7quickListNode结构</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/docs/pages/0fe872/#skiplist" class="sidebar-link">skipList</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#跳表结构" class="sidebar-link">跳表结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#跳表节点结构" class="sidebar-link">跳表节点结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#节点层高" class="sidebar-link">节点层高</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#跳表而不是平衡树" class="sidebar-link">跳表而不是平衡树？</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/docs/pages/0fe872/#整数集合" class="sidebar-link">整数集合</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#整数集合结构" class="sidebar-link">整数集合结构</a></li><li class="sidebar-sub-header level3"><a href="/docs/pages/0fe872/#集合升级" class="sidebar-link">集合升级</a></li><li class="sidebar-sub-header level4"><a href="/docs/pages/0fe872/#数组升级的好处" class="sidebar-link">数组升级的好处</a></li></ul></li></ul></li><li><a href="/docs/pages/e4e8ac/" class="sidebar-link">Redis分布式锁</a></li><li><a href="/docs/pages/cab1a1/" class="sidebar-link">缓存一致性</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/docs/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/docs/categories/?category=Redis" title="分类" data-v-06225672>Redis</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/cangxiaocoder" target="_blank" title="作者" class="beLink" data-v-06225672>苍晓</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-12-13</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Redis数据结构<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="sds"><a href="#sds" class="header-anchor">#</a> SDS</h2> <h3 id="sds与c字符串的区别"><a href="#sds与c字符串的区别" class="header-anchor">#</a> SDS与C字符串的区别</h3> <h5 id="sds字符串结构"><a href="#sds字符串结构" class="header-anchor">#</a> SDS字符串结构：</h5> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">sdshdr8</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint8_t</span> len<span class="token punctuation">;</span> <span class="token comment">/* 字符串长度 */</span>
    <span class="token class-name">uint8_t</span> alloc<span class="token punctuation">;</span> <span class="token comment">/* 分配的空间长度 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> <span class="token comment">/* SDS类型 */</span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* 字节数组 */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如下图redis中字符串数组结构</p> <p><img src="data:image/png;base64,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" alt="SDS结构"></p> <h5 id="o-1-复杂度获取字符串长度"><a href="#o-1-复杂度获取字符串长度" class="header-anchor">#</a> O(1)复杂度获取字符串长度</h5> <blockquote><p>len记录了字符串长度</p></blockquote> <p>在redis中<strong>len记录了字符串长度</strong>。获取字符串长度的时候只需要返回len的值就可以，时间复杂度为 O(1)。</p> <p>C 语言的字符串底层是一个字符数组，与Java字符串类似。如下图<code>char* str = redis</code>字符串数组结构：</p> <p><img src="data:image/png;base64,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" alt="redis"></p> <p>在 C 语言里，char * 指针只是指向字符数组的起始位置，而数组末尾用“\0”表示字符串结束的位置。因此，C字符串并不能记录自身的长度，为了获取字符串的长度需要遍历整个字符串，直到遇到空白字符“\0”为止，这个操作的复杂度为O(N)。所以字符串中不能含有“\0”字符，否则会被认为是字符串的结尾，这也导致C语言字符串只能保存文本数据，而不能保存图片、音频、视频等二进制数据。</p> <h5 id="避免缓冲区溢出"><a href="#避免缓冲区溢出" class="header-anchor">#</a> 避免缓冲区溢出</h5> <p>C 语言标准库中字符串的操作函数是很不安全的，对程序员很不友好，稍微一不注意，就会导致缓冲区溢出。</p> <p>举个例子，strcat 函数是可以将两个字符串拼接在一起</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">//将 src 字符串拼接到 dest 字符串后面</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在执行这个strcat函数时，如果没有分配足够多的内存可以容纳拼接后的字符串内容，就会产生缓冲区溢出；而且由于没有记录字符串长度，在操作字符串时都要遍历字符串的长度才能操作，<strong>对字符串的操作效率不高</strong>，</p> <p>与C字符串不同，Redis 中空间分配策略完全杜绝了发生缓冲区溢出的可能， SDS 结构里引入了 alloc 和 len 成员变量，当 SDS API 需要对SDS进行修改时，会先通过 <code>alloc - len</code> 计算来检查SDS空间是否满足要求，<strong>当判断出缓冲区大小不够用时，Redis 会自动将扩大 SDS 的空间大小</strong>，然后才执行实际修改操作。</p> <p>SDS 扩容的规则：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code>hisds <span class="token function">hi_sdsMakeRoomFor</span><span class="token punctuation">(</span>hisds s<span class="token punctuation">,</span> <span class="token class-name">size_t</span> addlen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>sh<span class="token punctuation">,</span> <span class="token operator">*</span>newsh<span class="token punctuation">;</span>
    <span class="token comment">/* 返回SDS中未使用的空间字符数 */</span>
    <span class="token class-name">size_t</span> avail <span class="token operator">=</span> <span class="token function">hi_sdsavail</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> len<span class="token punctuation">,</span> newlen<span class="token punctuation">;</span>
    <span class="token keyword">char</span> type<span class="token punctuation">,</span> oldtype <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> HI_SDS_TYPE_MASK<span class="token punctuation">;</span>
    <span class="token keyword">int</span> hdrlen<span class="token punctuation">;</span>

    <span class="token comment">/* 若的剩余空间已足够，无需扩展，直接返回. */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>avail <span class="token operator">&gt;=</span> addlen<span class="token punctuation">)</span> <span class="token keyword">return</span> s<span class="token punctuation">;</span>

    len <span class="token operator">=</span> <span class="token function">hi_sdslen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sh <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>s<span class="token operator">-</span><span class="token function">hi_sdsHdrSize</span><span class="token punctuation">(</span>oldtype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newlen <span class="token operator">=</span> <span class="token punctuation">(</span>len<span class="token operator">+</span>addlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newlen <span class="token operator">&lt;</span> HI_SDS_MAX_PREALLOC<span class="token punctuation">)</span>
        <span class="token comment">/* 新长度小于HI_SDS_MAX_PREALLOC，则分配两倍的空间 HI_SDS_MAX_PREALLOC = 1024*1024 = 1M*/</span>
        newlen <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        newlen <span class="token operator">+=</span> HI_SDS_MAX_PREALLOC<span class="token punctuation">;</span>

    type <span class="token operator">=</span> <span class="token function">hi_sdsReqType</span><span class="token punctuation">(</span>newlen<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* Don't use type 5: 不要使用类型 HI_SDS_TYPE_5*/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> HI_SDS_TYPE_5<span class="token punctuation">)</span> type <span class="token operator">=</span> HI_SDS_TYPE_8<span class="token punctuation">;</span>

    ···
    <span class="token comment">/* newlen被赋值给alloc*/</span>
    <span class="token function">hi_sdssetalloc</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> newlen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h5 id="减少内存重分配"><a href="#减少内存重分配" class="header-anchor">#</a> 减少内存重分配</h5> <p>由于C字符串长度和底层数组之间存在着关联性，所以每次增长或缩短一个以字符串都要对这个数组做一次内存重分配</p> <ul><li>如果是增长字符串，如字符串拼接，需要先扩展数组空间，否则会产生缓冲区溢出</li> <li>如果是缩短字符串，如字符串截断，需要选释放空间，否则就会产生内存泄漏</li></ul> <p>而SDS则使用一个len属性来记录字符串的长度，底层数组的长度不一定就是字符串的数量加一（包含结束符\0），通过未使用空间，SDS实现了空间预分配和惰性释放空间</p> <p>空间预分配：</p> <ol><li><strong>如果修改SDS字符串后，字符串的长度小于1MB，那么程序会分配2*len+1的空间</strong>（包含结束符\0）</li> <li><strong>如果修改SDS字符串后，字符串的长度大于1MB，那么程序会多分配1MB的未使用空间</strong></li></ol> <p>通过空间预分配策略，Redis会减少执行字符串增长时的内存重分配次数；</p> <p>如图当SDS执行<code>sdscat(s,”cluster”)</code>,SDS 将执行一次空间预分配策略，SDS的长度修改为12字节，预分配空间长度为24字节，当再次调用<code>sdscat(s,”tutorial”)</code>时，由于剩余空间<code>alloc - len</code>的长度足够新增字符串使用，Redis会直接使用未使用空间而无需执行内存重分配</p> <p><img src="/docs/assets/img/pre_memory.d5b13365.png" alt="内存预分配"></p> <p>惰性释放空间:</p> <p>当SDS需要缩短字符串时，Redis不会立即执行内存重分配来回收空间，而是修改len属性的长度，剩余空间用来以后增长字符串时使用。</p> <h5 id="二进制安全"><a href="#二进制安全" class="header-anchor">#</a> 二进制安全</h5> <p>C语言字符串中的字符必须符合编码规范并且不能出现空字符\0，而SDS不需要用 “\0” 字符来标识字符串结尾，而是用一个专门的len成员变量来记录数组长度，所以可存储包含 “\0” 的数据。但是 SDS 为了兼容部分 C 语言标准库的函数， SDS 字符串结尾还是会加上 “\0” 字符。</p> <p>SDS的API都是二进制安全的，所有SDS API都会以处理二进制的方式来处理SDS存放在buf[]数组中的数据，程序不会对其中的数据做任何限制，数据写入的时候时什么样的，它被读取时就是什么样的，因此Redis 不仅可以保存文本数据，也可以保存任意格式的二进制数据。</p> <h2 id="链表"><a href="#链表" class="header-anchor">#</a> 链表</h2> <h3 id="链表结构"><a href="#链表结构" class="header-anchor">#</a> 链表结构</h3> <h3 id="链表节点"><a href="#链表节点" class="header-anchor">#</a> 链表节点</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">listNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span> listNode<span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>节点之间通过前置指针(prev)和后置指针相连接(next)，组成一个双向链表</p> <p><img src="/docs/assets/img/listNode.077f3cae.png" alt="image-20221122224632036"></p> <h5 id="链表-2"><a href="#链表-2" class="header-anchor">#</a> 链表</h5> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">list</span> <span class="token punctuation">{</span>
    listNode <span class="token operator">*</span>head<span class="token punctuation">;</span> <span class="token comment">// 头结点</span>
    listNode <span class="token operator">*</span>tail<span class="token punctuation">;</span> <span class="token comment">// 尾节点</span>
    <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span>dup<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//节点值复制函数</span>
    <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>free<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//节点值释放函数</span>
    <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>match<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//节点值比较函数</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span> <span class="token comment">//链表节点数量</span>
<span class="token punctuation">}</span> list<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>list链表结构包含了头指针head、为指针tail、链表节点数量len、以及dup、free、match三个链表操作的函数</p> <p><img src="/docs/assets/img/list.4d8125df.png" alt="image-20221122225156515"></p> <h3 id="链表的特点"><a href="#链表的特点" class="header-anchor">#</a> 链表的特点</h3> <ul><li>双端： 链表节点里带有 prev 和 next 指针，获取某个节点的前置节点或后置节点的时间复杂度只需O(1)；</li> <li>无环：表头节点的 prev指针和表尾节点的 next 指针都指向null；</li> <li>带表头表尾指针：list 结构中包含 head 指针 head 和 tail 指针，获取链表的表头节点和表尾节点的时间复杂度都是O(1)；</li> <li>带链表长度计数器：List结构中用一个len属性来统计链表节点的数量，获取链表节点数量的复杂度是O(1)；</li> <li>多种类型：listNode 链表节使用 void* 指针保存节点值，并且可以通过 list 结构的 dup、free、match 函数指针为节点设置该节点类型特定的函数，所以链表节点可以保存各种不同类型的值；</li></ul> <p>缺陷：</p> <ul><li>链表每个节点通过前后指针相连，<strong>内存不连续，无法利用 CPU 的缓存</strong>。</li> <li>保存一个链表节点的值需要分配一个链表节点的空间，<strong>内存开销较大</strong>。</li></ul> <p>Redis 3.2 版本之前，Redis采用ZipList和LinkedList来实现List，当数据量较少的情况下会使用ZipList作为底层实现，可以节省空间，数据较多时采用LinkedList作为底层实现。</p> <p>Redis 3.2 版本之后，Redis设计了一个新的数据结构quickList，并统一采用quickList来实现List。</p> <h2 id="ziplist"><a href="#ziplist" class="header-anchor">#</a> ziplist</h2> <p>ZipList是一种特殊的“双端链表”，与LinkedList一样可以在任意一端进行压入、弹出的操作（都是O(1)的复杂度），ZipList是一种内存紧凑型数据结构，占用一块连续的内存空间，可以充分利用CPU缓存，而且可以根据数据的长度选择不同的编码，更有效的节省内存空间。</p> <h3 id="压缩列表结构"><a href="#压缩列表结构" class="header-anchor">#</a> 压缩列表结构</h3> <p>压缩列表是 Redis 为了节约内存而开发的，它是由连续内存块组成的顺序型数据结构，</p> <p><img src="data:image/png;base64,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" alt="image-20221126191213626"></p> <p>压缩列表属性：</p> <ul><li><em><strong>zlbytes</strong></em>：记录整个压缩列表占用对内存字节数；占4字节</li> <li><em><strong>zltail</strong></em>，记录压缩列表尾点距离起始地址有多少字节，通过这个偏移量，程序无序遍历整个压缩列表就可以确定尾结点的地址；占4字节；</li> <li><em><strong>zllen</strong></em>，记录压缩列表包含的节点数量；占2字节，当这个属性值小于UINT16_MAX(65535)时，这个属性值就是压缩列表包含所有节点的数量，当大于这个值时，节点真实数量需要遍历才能计算出；</li> <li><em><strong>zlend</strong></em>，标记压缩列表的结束点，固定值 0xFF（十进制255）。</li></ul> <h3 id="节点结构"><a href="#节点结构" class="header-anchor">#</a> 节点结构</h3> <p><img src="data:image/png;base64,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" alt="image-20221126192607632"></p> <p>节点属性：</p> <ul><li><p><em><strong>previous_entry_length</strong></em>：前一个节点的长度，占1个或5个字节，目的是为了实现从后向前遍历；</p> <ul><li>如果前一节点的长度小于254字节，则采用1个字节来保存这个长度值</li> <li>如果前一节点的长度大于254字节，则采用5个字节来保存这个长度值，第一个字节为0xf,后四个字节才是真实长度数据</li></ul></li> <li><p><em><strong>encoding</strong></em>：编码属性，记录content的数据类型（字符串还是整数）以及长度，占用1个、2个或5个字节</p></li> <li><p><em><strong>content</strong></em>：负责保存节点的数据，可以是字符串或整数</p></li></ul> <h5 id="previous-entry-length"><a href="#previous-entry-length" class="header-anchor">#</a> previous_entry_length</h5> <blockquote><p>压缩列表 特殊 “双端列表” A–&gt; B –&gt; C</p> <p>正向：B的地址 = A的地址+***B.previous_entry_length***的长度+***B.encoding***长度+***B.content***长度(encoding编码对应的长度)</p> <p>反向：B的地址 = C的地址-***C.previous_entry_length***的长度</p></blockquote> <h5 id="encoding"><a href="#encoding" class="header-anchor">#</a> encoding</h5> <ul><li><p>字符串：如果encoding是以“00”、“01”、“10”开头，则contents是字符串</p> <p><img src="/docs/assets/img/encoding_string.3efdae2c.png" alt="image-20221126194834928"></p></li> <li><p>整数：如果encoding是以“11”开头，则contents是整数，切encoding固定占用一个字节</p> <p><img src="/docs/assets/img/encoding_integer.9ad45f04.png" alt="image-20221126195002696"></p></li></ul> <h5 id="content"><a href="#content" class="header-anchor">#</a> content</h5> <p>content负责保存节点的值，节点的值可以是一个字节数组或者整数，值的类型和长度有encoding决定。</p> <ul><li><p>如果<strong>当前节点的数据是整数</strong>，则 encoding 会使用 <strong>1 字节的空间</strong>进行编码，也就是 encoding 长度为 1 字节。通过 encoding 确认了整数类型，就可以确认整数数据的实际大小了，比如如果 encoding 编码确认了数据是 int16 整数，那么 data 的长度就是 int16 的大小。</p> <p><img src="data:image/png;base64,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" alt="image-20221126203501637"></p></li> <li><p>如果<strong>当前节点的数据是字符串，根据字符串的长度大小</strong>，encoding 会使用 <strong>1 字节/2字节/5字节的空间</strong>进行编码，encoding 编码的前两个 bit 表示数据的类型，后续的其他 bit 标识字符串数据的实际长度，即 data 的长度。</p> <p><img src="data:image/png;base64,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" alt="image-20221126203547555"></p></li></ul> <h3 id="连锁更新"><a href="#连锁更新" class="header-anchor">#</a> 连锁更新</h3> <p><a href="https://github.com/antirez/listpack/blob/master/listpack.md" target="_blank" rel="noopener noreferrer">listpack/listpack.md at master · antirez/listpack --- listpack/listpack.md at master ·Antirez/Listpack (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ZipList每个节点previous_entry_length属性都保存着前一个节点的长度，previous_entry_length占用1或5个字节长度，</p> <ul><li>如果前一个<strong>节点的长度小于 254 字节</strong>，那么 previous_entry_length属性需要用 <strong>1 字节的空间</strong>来保存这个长度值；</li> <li>如果前一个<strong>节点的长度大于等于 254 字节</strong>，那么 previous_entry_length属性需要用 <strong>5 字节的空间</strong>来保存这个长度值；</li></ul> <p>假设一个压缩列表中有多个连续的、长度在 250～253 之间的节点：</p> <p><img src="data:image/png;base64,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" alt="image-20221127173350164"></p> <p>因为entey1~entryN节点长度都小于254字节，所以previous_entry_length只需要一个字节长度来记录前一个节点的长度，这时我们将一个大于等于254字节的新节点new设置为压缩列表的头节点，即entry1的前置节点，</p> <p><img src="/docs/assets/img/zipList_update1.c4b78c0c.png" alt="image-20221127174649017"></p> <p>由于entry1的previous_entry_length的属性长度仅为1个字节，无法保存新节点的长度，所以需要对压缩列表执行空间重分配工作，entry1的previous_entry_length属性从1字节扩展到5字节。经过扩展后entry1的字节长度就超过了254字节，所以需要扩展entry2节点的长度，正如扩展 entry1引发了对 entry2扩展一样，扩展 entry2 也会引发对 entry3 的扩展，…… 一直持续到entryN节点。</p> <p><img src="/docs/assets/img/zipList_update2.7537d92a.png" alt="image-20221127175249361"></p> <p>这种特殊情况下产生多次空间扩展操作称之为“<strong>连锁更新</strong>”</p> <h2 id="listpack"><a href="#listpack" class="header-anchor">#</a> listpack</h2> <p>参考<a href="https://github.com/antirez/listpack/blob/master/listpack.md" target="_blank" rel="noopener noreferrer">listpack/listpack.md at master · antirez/listpack --- listpack/listpack.md at master ·Antirez/Listpack (github.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token operator">&lt;</span>tot<span class="token operator">-</span>bytes<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>num<span class="token operator">-</span>elements<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>element<span class="token operator">-</span><span class="token number">1</span><span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">&lt;</span>element<span class="token operator">-</span>N<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>listpack<span class="token operator">-</span>end<span class="token operator">-</span>byte<span class="token operator">&gt;</span>
    
    
    <span class="token operator">&lt;</span>encoding<span class="token operator">-</span>type<span class="token operator">&gt;</span><span class="token operator">&lt;</span>element<span class="token operator">-</span>data<span class="token operator">&gt;</span><span class="token operator">&lt;</span>element<span class="token operator">-</span>tot<span class="token operator">-</span>len<span class="token operator">&gt;</span>
<span class="token operator">|</span>                                            <span class="token operator">|</span>
<span class="token operator">+</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">+</span>
            <span class="token punctuation">(</span>This is an element<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="listpack结构"><a href="#listpack结构" class="header-anchor">#</a> listpack结构</h3> <p>列表包被编码到单个线性内存块中。它有一个六字节的固定长度标头，后面跟着listpack节点</p> <p>节点包含三个元素</p> <ul><li>encoding，定义该元素的编码类型，会对不同长度的整数和字符串进行编码；</li> <li>data，实际存放的数据；</li> <li>len，encoding+data的总长度；</li></ul> <p><img src="/docs/assets/img/image-20231025163346502.6acf1f59.png" alt="image-20231025163346502"></p> <h2 id="quicklist"><a href="#quicklist" class="header-anchor">#</a> quickList</h2> <p>在 Redis 3.0 之前，List 对象的底层数据结构是双向链表或者压缩列表。子啊3.2版本中引入了一个新的数据结构quickList。 quicklist 是一个双向链表，链表中每个节点都是一个ZipList结构。</p> <h3 id="旧quicklist结构"><a href="#旧quicklist结构" class="header-anchor">#</a> 旧quickList结构</h3> <p><img src="/docs/assets/img/quicklist.cb8b1dbe.png" alt="image-20221127184657314"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklist</span> <span class="token punctuation">{</span>
    quicklistNode <span class="token operator">*</span>head<span class="token punctuation">;</span>	<span class="token comment">/* 头指针 */</span>
    quicklistNode <span class="token operator">*</span>tail<span class="token punctuation">;</span>	<span class="token comment">/* 尾指针 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> count<span class="token punctuation">;</span>	<span class="token comment">/* ziplist节点个数 即列表中总元素个数 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span>		<span class="token comment">/* quicklistNode节点个数 */</span>
    <span class="token keyword">int</span> fill <span class="token operator">:</span> QL_FILL_BITS<span class="token punctuation">;</span>              <span class="token comment">/* 指明ziplist长度 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> compress <span class="token operator">:</span> QL_COMP_BITS<span class="token punctuation">;</span> <span class="token comment">/* 0:禁用压缩，否则代表quicklistnode在quicklist末尾未压缩的数量 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> bookmark_count<span class="token operator">:</span> QL_BM_BITS<span class="token punctuation">;</span> <span class="token comment">/*Bookmakrs是realloc这个结构体使用的可选特性，这样它们在不使用时就不会消耗内存*/</span>
    quicklistBookmark bookmarks<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> quicklist<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Redis提供了一个配置项：list-max-ziplist-size来限制。</p> <ul><li><p>如果值为正，则代表ziplist的允许的entry个数的最大值</p></li> <li><p>如果值为负，则代表ziplist的最大内存大小，分5种情况：</p> <ol><li>-1：每个ziplist的内存占用不能超过4kb</li> <li>-2：每个ziplist的内存占用不能超过8k</li> <li>-3：每个ziplist的内存占用不能超过16kb</li> <li>-4：每个ziplist的内存占用不能超过32kb</li> <li>-5：每个ziplist的内存占用不能超过64kb
其默认值为-2：</li></ol> <p><img src="data:image/png;base64,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" alt="image-20221127182113284"></p></li></ul> <h3 id="旧quicklistnode结构"><a href="#旧quicklistnode结构" class="header-anchor">#</a> 旧quickListNode结构</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>	<span class="token comment">/* 前一个quicklistNode */</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>	<span class="token comment">/* 后前一个quicklistNode */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>zl<span class="token punctuation">;</span>			<span class="token comment">/* quicklistNode指向的ziplist */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> sz<span class="token punctuation">;</span>             <span class="token comment">/* ziplist 字节大小 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> count <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span>     <span class="token comment">/* count of items in ziplist */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> encoding <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">/* 编码方式：1：原生 or 2：LZF压缩 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> container <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">/* NONE==1 or ZIPLIST==2 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> recompress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* 这个节点之前是否为压缩节点 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> attempted_compress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* node can't compress; too small */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> extra <span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">/* more bits to steal for future usage */</span>
<span class="token punctuation">}</span> quicklistNode<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>quick list的每个节点的实际数据是ziplist，这这种结构的优势在于节省空间，为了进一步降低使用空间，Redis可以采取LZF算法对ziplist进一步压缩。</p> <h3 id="redis7quicklist结构"><a href="#redis7quicklist结构" class="header-anchor">#</a> Redis7quickList结构</h3> <p>在Redis7中，很多数据结构都从ziplist主键替换成了listpack</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get zset*
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;zset-max-ziplist-value&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;64&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;zset-max-listpack-entries&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;128&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;zset-max-ziplist-entries&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;128&quot;</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;zset-max-listpack-value&quot;</span>
<span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;64&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get hash*
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">&quot;hash-max-ziplist-entries&quot;</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">&quot;512&quot;</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">&quot;hash-max-listpack-value&quot;</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">&quot;64&quot;</span>
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">&quot;hash-max-listpack-entries&quot;</span>
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">&quot;512&quot;</span>
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">&quot;hash-max-ziplist-value&quot;</span>
<span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">&quot;64&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>在 Redis 7中，quicklist结构中每个节点都由zipList修改为listPack结构</p> <p><img src="/docs/assets/img/quicklist_new.a1faa085.png" alt="image-20231025164112778"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklist</span> <span class="token punctuation">{</span>
    quicklistNode <span class="token operator">*</span>head<span class="token punctuation">;</span>	<span class="token comment">/* 头指针 */</span>
    quicklistNode <span class="token operator">*</span>tail<span class="token punctuation">;</span>	<span class="token comment">/* 尾指针 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> count<span class="token punctuation">;</span>	<span class="token comment">/* listpacks节点个数 即列表中总元素个数 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> len<span class="token punctuation">;</span>		<span class="token comment">/* quicklistNode节点个数 */</span>
    <span class="token keyword">signed</span> <span class="token keyword">int</span> fill <span class="token operator">:</span> QL_FILL_BITS<span class="token punctuation">;</span>       <span class="token comment">/* 单个节点填充系数 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> compress <span class="token operator">:</span> QL_COMP_BITS<span class="token punctuation">;</span> <span class="token comment">/* 如果禁用压缩，则为0，否则为在quicklist末尾未压缩的quickListNode数;0=off */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> bookmark_count<span class="token operator">:</span> QL_BM_BITS<span class="token punctuation">;</span>
    quicklistBookmark bookmarks<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/*  可选功能，不用时不消耗内存*/</span>
<span class="token punctuation">}</span> quicklist<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="redis7quicklistnode结构"><a href="#redis7quicklistnode结构" class="header-anchor">#</a> Redis7quickListNode结构</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>	<span class="token comment">/* 前一个quicklistNode */</span>
    <span class="token keyword">struct</span> <span class="token class-name">quicklistNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>	<span class="token comment">/* 后前一个quicklistNode */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>entry<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> sz<span class="token punctuation">;</span>             <span class="token comment">/* 节点大小 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> count <span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">;</span>     <span class="token comment">/* 包含的 listpack数 16 bits, max 65536 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> encoding <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">/* 2 bits RAW==1 or LZF==2 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> container <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">/* 2 bits PLAIN==1代表char数组 or PACKED==2 代表listpack */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> recompress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* 1 bit 布尔值，表示之前是否被压缩过 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> attempted_compress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/*1 bit  node can't compress; too small */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> dont_compress <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">/* prevent compression of entry that will be used later */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> extra <span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">;</span> <span class="token comment">/*10 bits more bits to steal for future usage */</span>
<span class="token punctuation">}</span> quicklistNode<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="skiplist"><a href="#skiplist" class="header-anchor">#</a> skipList</h2> <p>Redis  中只有 Zset 对象的底层用到了跳表，Zset 结构体里包含两个两个数据结构：一个是跳表，一个是哈希表。跳表节点查找的时间复杂度为 O(logN)，并且支持范围查找。哈希表支持O(1)复杂度的节点查找，所以Zset即支持快速单节点查询也能够快速进行范围查找。</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/* server.h */</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zset</span> <span class="token punctuation">{</span>
    dict <span class="token operator">*</span>dict<span class="token punctuation">;</span> <span class="token comment">/* 哈希表 */</span>
    zskiplist <span class="token operator">*</span>zsl<span class="token punctuation">;</span> <span class="token comment">/* 跳表哈希表 */</span>
<span class="token punctuation">}</span> zset<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Zset 对象在执行数据插入或是数据更新的过程中，会依次在跳表和哈希表中插入或更新相应的数据，Zset 使用调表可以进行快速范围查询（如 ZRANGEBYSCORE 操作），使用哈希表可以快速查询节点权重（如 ZSCORE 操作）。</p> <h3 id="跳表结构"><a href="#跳表结构" class="header-anchor">#</a> 跳表结构</h3> <p>链表在查找节点元素的时候，需要从头节点逐一遍历查找，时间复杂度是O(N)。<strong>跳表则是在链表基础上进行改进，实现了一种「多层」的有序链表</strong>，通过层级遍历，查找节点的复杂度平均为O(logN)。</p> <p><img src="/docs/assets/img/skiplist.35a9c1c5.png" alt="image-skiplist"></p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplist</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>header<span class="token punctuation">,</span> <span class="token operator">*</span>tail<span class="token punctuation">;</span> <span class="token comment">/* 头尾节点指针 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> length<span class="token punctuation">;</span> <span class="token comment">/* 节点数量 */</span>
    <span class="token keyword">int</span> level<span class="token punctuation">;</span> <span class="token comment">/* 最大索引层级，默认为1 最大为32*/</span>
<span class="token punctuation">}</span> zskiplist<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="跳表节点结构"><a href="#跳表节点结构" class="header-anchor">#</a> 跳表节点结构</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token punctuation">{</span>
    sds ele<span class="token punctuation">;</span> <span class="token comment">/* 节点值 */</span>
    <span class="token keyword">double</span> score<span class="token punctuation">;</span> <span class="token comment">/* 节点分数，用于排序、查找 */</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>backward<span class="token punctuation">;</span> <span class="token comment">/* 前一个节点指针 */</span>
    <span class="token keyword">struct</span> <span class="token class-name">zskiplistLevel</span> <span class="token punctuation">{</span>
        <span class="token keyword">struct</span> <span class="token class-name">zskiplistNode</span> <span class="token operator">*</span>forward<span class="token punctuation">;</span> <span class="token comment">/* 下一个节点指针 */</span>
        <span class="token keyword">unsigned</span> <span class="token keyword">long</span> span<span class="token punctuation">;</span> <span class="token comment">/* 指针跨度 */</span>
    <span class="token punctuation">}</span> level<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/* 多级指针数组 */</span>
<span class="token punctuation">}</span> zskiplistNode<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="节点层高"><a href="#节点层高" class="header-anchor">#</a> 节点层高</h3> <blockquote><p>跳表最高支持32级。</p></blockquote> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ZSKIPLIST_MAXLEVEL</span> <span class="token expression"><span class="token number">32</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ZSKIPLIST_P</span> <span class="token expression"><span class="token number">0.25</span></span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>Redis用一个函数随机生成一个1~32之间的值作为新节点的高度，值越大出现的概率越低，默认为1级</p></blockquote> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">zslRandomLevel</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token number">0xFFFF</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token punctuation">(</span>ZSKIPLIST_P <span class="token operator">*</span> <span class="token number">0xFFFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">/* 0xFFFF = 65535 */</span>
        level <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>level<span class="token operator">&lt;</span>ZSKIPLIST_MAXLEVEL<span class="token punctuation">)</span> <span class="token operator">?</span> level <span class="token operator">:</span> ZSKIPLIST_MAXLEVEL<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>level的初始值为1，通过while循环，每次生成一个随机数，取这个随机数的低16位与<code>ZSKIPLIST_P * 0xFFFF</code>比较，小于则加1继续循环，否则退出，</p> <ul><li>节点层高为1的概率为1-p。</li> <li>节点层高为2的概率为p(1-p)。</li> <li>节点层高为3的概为p^2^(1-p)。</li> <li>......</li> <li>节点层高为n的概为p^n^(1-p)。</li></ul> <p>所以节点的期望层高为：</p> <p>E=1*(1-p)+2<em>p(1-p)+3</em>p^2^(1-p)+…+n*p^n-1^(1-p) = (1-p)$\sum_{i=1}^n$ ip^i-1^​=1/(1-p)</p> <ul><li>当p=1/2时，每个节点所包含的平均指针数目为2；</li> <li>当p=1/4时，每个节点所包含的平均指针数目为1.33。</li></ul> <h3 id="跳表而不是平衡树"><a href="#跳表而不是平衡树" class="header-anchor">#</a> 跳表而不是平衡树？</h3> <p>对于这个问题，Redis的作者 @antirez 是怎么说的：</p> <blockquote><p>There are a few reasons:</p> <ol><li><p>They are not very memory intensive. It's up to you basically. Changing parameters about the probability of a node to have a given number of levels will make then less memory intensive than btrees.</p></li> <li><p>A sorted set is often target of many ZRANGE or ZREVRANGE operations, that is, traversing the skip list as a linked list. With this operation the cache locality of skip lists is at least as good as with other kind of balanced trees.</p></li> <li><p>They are simpler to implement, debug, and so forth. For instance thanks to the skip list simplicity I received a patch (already in Redis master) with augmented skip lists implementing ZRANK in O(log(N)). It required little changes to the code.</p></li></ol></blockquote> <ol><li><strong>内存占用更低</strong>，平衡树每个节点包含两个指针，而跳表每个节点平均包含1.33个指针，</li> <li><strong>适合范围查找</strong>，在平衡树上，查询单个节点可以直接用前序遍历(<strong>根-左-右</strong>)，如果要进行范围查找则需要以中序遍历(<strong>左-根-右</strong>)的方式，而在调表上，只需要在找到最小值之后，顺着leve1层的后置指针遍历就可以实现。</li> <li><strong>算法实现比平衡树简单</strong>，跳表更易于实现、调试，平衡树的插入和删除操作都可能引起子树的调整，逻辑复杂，而跳表则可以像普通链表一样只需要修改相邻节点的指针就完成了插入删除操作。</li></ol> <h2 id="整数集合"><a href="#整数集合" class="header-anchor">#</a> 整数集合</h2> <p>整数集合(IntSet)是 Set 对象的底层实现之一。当一个 Set 对象只包含整数值元素，并且元素数量不大时，就会使用整数集这个数据结构作为底层实现。</p> <h3 id="整数集合结构"><a href="#整数集合结构" class="header-anchor">#</a> 整数集合结构</h3> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">intset</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint32_t</span> encoding<span class="token punctuation">;</span> <span class="token comment">/*编码方式 支持存放16位、32位、64位整数*/</span>
    <span class="token class-name">uint32_t</span> length<span class="token punctuation">;</span> <span class="token comment">/*元素个数*/</span>
    <span class="token class-name">int8_t</span> contents<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">/*整数数组，存放集合数据*/</span>
<span class="token punctuation">}</span> intset<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>encoding包含三种模式</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/* Note that these encodings are ordered, so:
 * INTSET_ENC_INT16 &lt; INTSET_ENC_INT32 &lt; INTSET_ENC_INT64. */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INTSET_ENC_INT16</span> <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">int16_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  </span><span class="token comment">/*16位 2字节 类似Java中的short*/</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INTSET_ENC_INT32</span> <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  </span><span class="token comment">/*32位 4字节 类似Java中的int*/</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INTSET_ENC_INT64</span> <span class="token expression"><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token class-name">int64_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  </span><span class="token comment">/*64位 8字节 类似Java中的long*/</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>为了方便查找，contents中的数值按照从小到大排列，并且数组中不包含任何重复的数据；</p> <p>如图数组中每个元素都是16位2字节大小，</p> <ul><li>encoding：4字节</li> <li>length：4字节</li> <li>contents：2字节*4 = 8字节</li> <li>总共4+4+8字节 = 16字节</li></ul> <p><img src="/docs/assets/img/image-20230313213319268.39a05e1c.png" alt="image-20230313213319268"></p> <h3 id="集合升级"><a href="#集合升级" class="header-anchor">#</a> 集合升级</h3> <p>当我们将一个新元素加入到整数结合中时，如果新元素类型比整数集合中的所有元素的类型都要长，整数集合需要先进行升级，也就是按照新元素类型的长度扩展contents数组的空间大小，然后才能将新元素插入到整数集合里。升级过程共分为三步：</p> <ol><li><p>根据新元素类型扩展整数数组的空间大小，并为新元素分配空间</p></li> <li><p>将底层数组先有的所有元素都转换成与新元素相同的类型，并将类型转换后的元素放置到正确的位置上，并且要维持顶层数组的有序性不变；</p></li> <li><p>将新元素添加到底层数组里面</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">/* Upgrades the intset to a larger encoding and inserts the given integer. */</span>
<span class="token keyword">static</span> intset <span class="token operator">*</span><span class="token function">intsetUpgradeAndAdd</span><span class="token punctuation">(</span>intset <span class="token operator">*</span>is<span class="token punctuation">,</span> <span class="token class-name">int64_t</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取当前intset编码</span>
    <span class="token class-name">uint8_t</span> curenc <span class="token operator">=</span> <span class="token function">intrev32ifbe</span><span class="token punctuation">(</span>is<span class="token operator">-&gt;</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取新元素编码  </span>
    <span class="token class-name">uint8_t</span> newenc <span class="token operator">=</span> <span class="token function">_intsetValueEncoding</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token function">intrev32ifbe</span><span class="token punctuation">(</span>is<span class="token operator">-&gt;</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断value是否大于0决定value放在数组最前还是最后，value是正数一定是最大的，value时负数一定是最小的</span>
    <span class="token keyword">int</span> prepend <span class="token operator">=</span> value <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">/* First set new encoding and resize 重置编码为新编码*/</span>
    is<span class="token operator">-&gt;</span>encoding <span class="token operator">=</span> <span class="token function">intrev32ifbe</span><span class="token punctuation">(</span>newenc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//重置数组大小</span>
    is <span class="token operator">=</span> <span class="token function">intsetResize</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span><span class="token function">intrev32ifbe</span><span class="token punctuation">(</span>is<span class="token operator">-&gt;</span>length<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* 倒序遍历，将元素依次移动到新位置 _intsetGetEncoded按照旧编码方式查找元素*/</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>length<span class="token operator">--</span><span class="token punctuation">)</span>
        <span class="token function">_intsetSet</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span>length<span class="token operator">+</span>prepend<span class="token punctuation">,</span><span class="token function">_intsetGetEncoded</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span>length<span class="token punctuation">,</span>curenc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*决定将新元素插入到数组最前还是最后的位置*/</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prepend<span class="token punctuation">)</span>
        <span class="token function">_intsetSet</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">_intsetSet</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span><span class="token function">intrev32ifbe</span><span class="token punctuation">(</span>is<span class="token operator">-&gt;</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//修改数组长度</span>
    is<span class="token operator">-&gt;</span>length <span class="token operator">=</span> <span class="token function">intrev32ifbe</span><span class="token punctuation">(</span><span class="token function">intrev32ifbe</span><span class="token punctuation">(</span>is<span class="token operator">-&gt;</span>length<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> is<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div></li></ol> <p>举个例子，假设现在有个INTSET_ENC_INT16编码的整数集合，集合中包含了三个into6_t类型的元素</p> <p><img src="/docs/assets/img/image-20230314211956881.5e46443a.png" alt="image-20230314211956881"></p> <p>现在假设要将一个类型为int32_t的整数65535添加到集合里面，因为新元素的类型int32_t比所有元素都长，所以整数集合要进行升级操作，需要为 contents 数组扩容，在原本空间的大小之上再扩容多 80 位（4x32-3x16=80），才能保存下 4 个类型为 int32_t 的元素</p> <p><img src="/docs/assets/img/image-20230314215858440.f259dfe2.png" alt="image-20230314215858440"></p> <p>扩容数组大小之后，将之前的三个元素转换成int32_t编码，倒序遍历将转换之后的元素重新放入到正确的位置，并且维持数组的有序性不变，转换过程：</p> <ol><li><p>将元素3转换为int32_t类型然后移动到新位置</p> <p><img src="/docs/assets/img/image-20230314220100469.110a98a1.png" alt="image-20230314220100469"></p></li> <li><p>将元素2转换为int32_t类型然后移动到新位置</p> <p><img src="/docs/assets/img/image-20230314220228947.0dbb03c2.png" alt="image-20230314220228947"></p></li> <li><p>将元素1转换为int32_t类型</p> <p><img src="/docs/assets/img/image-20230314220346078.345957b4.png" alt="image-20230314220346078"></p></li> <li><p>插入新元素</p> <p><img src="/docs/assets/img/image-20230314220423549.2e659ae1.png" alt="image-20230314220423549"></p></li></ol> <h4 id="数组升级的好处"><a href="#数组升级的好处" class="header-anchor">#</a> 数组升级的好处</h4> <p><strong>提升灵活性</strong></p> <p>整数集合可以通过自动升级底层数组来适应新元素，所有可以随意的将int16_t、int32_t、int64_t类型的证书添加到集合中而不必担心类型错误</p> <p><strong>节约内存</strong></p> <p>要让一个数组同时保存int16_t、int32_t、int64_t类型的值，最简答的做法是直接使用int64_t类型作为数组底层的实现，这样即使是int16_t类型的值都需要使用int64_t来保存，从而出现浪费内存的情况，而整数集合升级就可以避免这种情况，如果一直向整数集合添加 int16_t 类型的元素，那么整数集合的底层实现就一直是用 int16_t 类型的数组，只有在我们要将 int32_t 类型或 int64_t 类型的元素添加到集合时，才会对数组进行升级操作</p> <blockquote><p>数组不支持降级，</p></blockquote> <p>数组一旦升级就会一直保持升级后的状态，即使删除了65535这个元素，数组依然会使用int32_t类型来保存数值</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/cangxiaocoder/docs/edit/main/docs/Redis/Redis数据结构.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/docs/tags/?tag=%E6%95%B0%E6%8D%AE%E5%BA%93" title="标签">#数据库</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/10/25, 08:42:55</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/docs/pages/8bd4f4/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Redis基本操作</div></a> <a href="/docs/pages/e4e8ac/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Redis分布式锁</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/pages/8bd4f4/" class="prev">Redis基本操作</a></span> <span class="next"><a href="/docs/pages/e4e8ac/">Redis分布式锁</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/docs/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/docs/pages/c15ffb/"><div>
            Maven
            <!----></div></a> <span class="date">09-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/docs/pages/5afdd2/"><div>
            kafka面试题
            <!----></div></a> <span class="date">06-10</span></dt></dl><dl><dd>03</dd> <dt><a href="/docs/pages/cab1a1/"><div>
            Redis缓存一致性
            <!----></div></a> <span class="date">04-06</span></dt></dl> <dl><dd></dd> <dt><a href="/docs/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:2809226095@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/cangxiaocoder" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>cangxiao | <a href="https://github.com/cangxiaocoder/docs/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/docs/assets/js/app.64f7fb70.js" defer></script><script src="/docs/assets/js/2.9aaacc6a.js" defer></script><script src="/docs/assets/js/3.039d8d6e.js" defer></script>
  </body>
</html>
