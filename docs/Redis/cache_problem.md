---
title: cache_problem
date: 2023-11-02 23:16:49
permalink: /pages/773cf0/
categories:
  - Redis
tags:
  - 
author: 
  name: cangxiao
  link: https://github.com/cangxiaocoder
---

## 缓存问题

### 缓存穿透

缓存穿透是指用户访问的数据，<mark>既不在缓存中也不在数据库中</mark>，请求先去访问缓存，发现缓存中不存在数据，再去访问数据库时，发现数据库中也不存在数据，因此无法构建缓存，后续所有的请求都会穿过缓存去访问数据库。如果此时有大量的请求过来，就会导致数据库的压力骤增进而导致数据库崩溃。

解决方案：

1.   限制非法请求

     用户请求的数据几步存在缓存中也不存在数据库中，说明这个请求可能是非法的，所以在请求API时我们需要判断请求参数是否合理，如果判断请求非法就直接返回错误，避免再去请求缓存和数据库。
2.   缓存空数据
     
     当查询的数据不存在时，可以在缓存中设置一个空数据或默认值，当后续发生相同的请求时就可以从缓存中读取数据，避免请求发到数据库。

     优点：简单

     缺点：会造成数据不一致，可能需要缓存很多空数据

3.   布隆过滤器

     优点：内存占用较少，没有多余key

     缺点：实现复杂，存在误判，当出现哈希冲突时，查询布隆过滤器数据存在，但是数据库中却不存在数据，仍然有可能发生缓存穿透。

#### 布隆过滤器

布隆过滤器是一个bitmap位图，相当于是一个一bit位为单位的数组，数组中每个单元只能存储二进制数0或1；

存储数据时，将key值经过多个不同的哈希算法过得哈希值	，根据哈希计算数组对应的位置改为1；

查询数据时，使用相同的哈希函数获得多个哈希值，判断数组对应位置是否都为1，如果有一个不为1，说明数据不存在；

### 缓存击穿

给一个key设置了过期时间，当这个key过期时，大量的请求过来查询这个key，由于缓存过期，这些请求都会请求数据库，大量的请求击垮数据库

解决方案：

1.   互斥锁
2.   逻辑过期

### 缓存雪崩

#### 大量数据同时过期


#### Redis宕机